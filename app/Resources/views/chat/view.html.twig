{% extends '::base.html.twig' %}

{% block body %}
    <div class="container-fluid">
        <header class="border border-top-0 border-left-0 border-right-0 mb-3 py-3">
            <strong>{{ chat.name }}</strong> :: {{ chat.topic }}
        </header>
        <div class="row">
            <div class="col-md-10">
                {% for message in messages %}
                    <div class="row">
                        <div class="col-md-2">{{ message.author.username }}</div>
                        <div class="col-md-9">{{ message.message }}</div>
                        <div class="col-md-1 text-right">
                            <span title="{{ message.timestamp | date('M d, Y h:m:ia') }}">{{ message.timestamp | date('h:ma') }}</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="col-md-2">
                <ul>
                    {% for user in users %}
                        <li>{{ user.user.username }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <section>
            {{ form(form) }}
        </section>
    </div>
{% endblock %}

{% block javascripts %}
    <script src="https://js.pusher.com/4.1/pusher.min.js"></script>
    <script>
        {% if app.debug %}
            // Enable pusher logging - don't include this in production
            Pusher.logToConsole = true;
        {% endif %}

        var pusher = new Pusher({{ push_key }}, {
            cluster: 'us2',
            encrypted: true
        });

        var channel = pusher.subscribe('my-channel');
        channel.bind('my-event', function(data) {
            console.log(data.message);
        });
    </script>
{% endblock %}
